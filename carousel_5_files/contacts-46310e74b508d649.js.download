(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[341],{51523:function(e,t,n){"use strict";var s=n(67294);function i(e){return e}t.Z=function(e){const[t,n]=s.useState(!1),r=s.useRef((()=>n(!1)));function a(){return n(!0)}function c(){return n(i)}return s.useEffect((()=>r.current),[e]),{copied:t,copy:s.useCallback((()=>function(e){if(navigator.clipboard)return navigator.clipboard.writeText(e);const t=document.createElement("span");t.textContent=e,t.style.whiteSpace="pre",document.body.appendChild(t);const n=window.getSelection();if(!n)return Promise.reject();const s=window.document.createRange();n.removeAllRanges(),s.selectNode(t),n.addRange(s);try{window.document.execCommand("copy")}catch(i){return Promise.reject()}return n.removeAllRanges(),window.document.body.removeChild(t),Promise.resolve()}(e).then(a).catch(c)),[e]),reset:r.current}}},47489:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/crm/contacts",function(){return n(49387)}])},46284:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var s=n(85893),i=n(51523),r=n(67294),a=n(33303),c=n(30112),o=n(66605);function l(e){var t=e.text,n=e.children,l=e.className,d=e.alwaysShowIcon,u=void 0!==d&&d,m=(0,i.Z)(t||n),x=m.copied,p=m.copy,h=m.reset,f=function(e){e.stopPropagation(),p()};return(0,r.useEffect)((function(){var e=setTimeout((function(){h()}),2e3);return function(){clearTimeout(e)}}),[x]),(0,s.jsxs)("div",{className:(0,a.AK)("inline-flex items-center group relative",l),children:[n,x?(0,s.jsxs)("div",{className:(0,a.AK)("ml-1 flex items-center absolute -right-5 text-green-500 transition-opacity",!u&&"group-hover:opacity-100 opacity-0 "),children:[(0,s.jsx)(c.Z,{icon:"CheckIcon",className:"w-5 h-5"}),(0,s.jsx)("div",{className:"absolute left-5",children:"Copied"})]}):(0,s.jsx)(o.Z,{alt:(0,s.jsxs)("span",{onClick:f,children:["Copy ",t]}),children:(0,s.jsx)(c.Z,{icon:"DocumentDuplicateSolidIcon",onClick:f,className:(0,a.AK)("w-5 h-5 ml-1 transition-opacity text-indigo-600 hover:!opacity-70 cursor-pointer",!u&&"group-hover:opacity-100 opacity-0 ")})})]})}},49387:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var s,i=n(47568),r=n(26042),a=n(69396),c=n(10253),o=n(51351),l=n(29815),d=n(70655),u=n(85893),m=n(67294),x=n(30112),p=n(16494),h=n(33303),f=n(41664),g=n.n(f),v=n(51121),y=n(68710),j=n(57554),w=n(65082),N=n(74007),b=n(11163),k=n(43490),C=n(33253),_=n(30120),Z=n(74274),I=n(60728),S=n(5625),A=n(72510),E=n(86067),F=n(52077),K=n(46284),R=n(33299),D=n(53371),P={firstName:"",lastName:"",email:"",phone:"",company:"",address:{line1:"",line2:"",city:"",state:"",country:"",postalCode:""},notes:"",customFields:[]},q=[{_id:"company",name:"company",default:!0},{_id:"lastMessage.createdAt",name:"Last lead",default:!0},{_id:"feedback",name:"feedback",default:!0},{_id:"phone",name:"phone",default:!0},{_id:"address",name:"address",default:!0}];function T(e){e=null!==e?e:(0,o.Z)(new TypeError("Cannot destructure undefined"));var t,n,f,T,M,O,U,z,X,L,G,H,B,$,V,Y,Q,J,W,ee,te,ne=function(e){var t;if((null===e||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.length)>0){var n=e.messages.sort((function(e,t){return new Date(t.createdAt)-new Date(e.createdAt)}))[0];return(null===n||void 0===n?void 0:n.createdAt)?_.ou.fromISO(n.createdAt).toFormat("DD @ HH:mm"):""}return""},se=(0,c.Z)((0,E.Z)("layout.title","CRM",!0),2),ie=(se[0],se[1],(0,m.useState)(!1)),re=ie[0],ae=ie[1],ce=(0,m.useState)((0,h.tl)("business.settings")),oe=ce[0],le=ce[1],de=(0,m.useState)((0,h.tl)("customers")),ue=de[0],me=de[1],xe=(0,m.useState)((0,h.tl)("customer.custom-fields")),pe=xe[0],he=xe[1],fe=(0,m.useState)(""),ge=fe[0],ve=fe[1],ye=(0,m.useState)(!1),je=ye[0],we=ye[1],Ne=(0,m.useState)(null),be=Ne[0],ke=Ne[1],Ce=(0,m.useState)(1),_e=Ce[0],Ze=Ce[1],Ie=(0,m.useState)(!1),Se=Ie[0],Ae=Ie[1],Ee=(0,m.useState)(!1),Fe=Ee[0],Ke=Ee[1],Re=(0,m.useState)(q),De=Re[0],Pe=Re[1],qe=(0,m.useState)([]),Te=qe[0],Me=qe[1],Oe=(0,m.useState)("createdAt"),Ue=Oe[0],ze=Oe[1],Xe=(0,m.useState)(-1),Le=Xe[0],Ge=Xe[1],He=(0,m.useState)(null),Be=He[0],$e=He[1],Ve=(0,m.useState)(null),Ye=Ve[0],Qe=Ve[1],Je=(0,m.useState)(null),We=Je[0],et=Je[1],tt=(0,m.useState)(null),nt=tt[0],st=tt[1],it=(0,m.useState)(null),rt=it[0],at=it[1],ct=(0,m.useState)((0,h.tl)("business.config")),ot=ct[0],lt=ct[1],dt=(0,m.useState)(!1),ut=dt[0],mt=dt[1],xt=(0,m.useState)(-1),pt=xt[0],ht=xt[1],ft=(0,m.useState)(!1),gt=ft[0],vt=ft[1],yt=(0,m.useState)(!1),jt=yt[0],wt=yt[1],Nt=(0,w.Z)(),bt=Nt.get,kt=Nt.post,Ct=Nt.remove,_t=(0,I.Z)(),Zt=_t.confirm,It=_t.ConfirmDialog,St=(0,I.Z)(),At=St.confirm,Et=St.ConfirmDialog,Ft=(0,R.useSession)().data,Kt=(0,b.useRouter)(),Rt=Kt.query,Dt=Rt.open,Pt=Rt.email,qt=Rt.firstName,Tt=Rt.lastName,Mt=function(){var e=(0,i.Z)((function(e){var t,n,s,r;return(0,d.__generator)(this,(function(a){switch(a.label){case 0:return nt&&(null===nt||void 0===nt?void 0:nt.reviews)&&((null===nt||void 0===nt?void 0:nt.reviews.enableGoogleReviews)&&(null===nt||void 0===nt?void 0:nt.reviews.googleURL)||(null===nt||void 0===nt?void 0:nt.reviews.enableFacebookReviews)&&(null===nt||void 0===nt?void 0:nt.reviews.facebookURL))&&(null===nt||void 0===nt||null===(t=nt.reviews)||void 0===t||null===(n=t.template)||void 0===n?void 0:n.content)&&(null===nt||void 0===nt||null===(s=nt.reviews)||void 0===s||null===(r=s.template)||void 0===r?void 0:r.title)?(Zt("Request a review from ".concat(e.firstName).concat(e.lastName?" "+e.lastName:""),(0,u.jsxs)(u.Fragment,{children:[Array.isArray(e.reviewRequested)&&e.reviewRequested.length>0?(0,u.jsxs)("span",{className:"block text-red-500 mb-2",children:["You last requested this contact for a review on ",_.ou.fromISO(e.reviewRequested[e.reviewRequested.length-1]).toFormat("DD")]}):"",(0,u.jsx)("span",{className:"border p-2 my-4 block bg-gray-50 w-full",children:e.rating?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("span",{className:"font-medium",children:[e.firstName," left this feedback after paying an invoice:"]}),(0,u.jsx)(C.Z,{className:"block mt-3",rating:e.rating||0,readOnly:!0})]}):"".concat(e.firstName," has not yet left feedback for your business!")}),"Choose your review platform in",(0,u.jsx)(g(),{href:"/marketing/reviews",children:(0,u.jsx)("a",{className:"link ml-1",children:"settings"})}),"."]}),(0,i.Z)((function(){var t;return(0,d.__generator)(this,(function(n){switch(n.label){case 0:return[4,kt("/marketing/request-review",{idCustomer:e._id}).catch(console.log)];case 1:return(t=n.sent())&&!0===t.status?(h.Z9.success("Review requested!"),e.reviewRequested.push(_.ou.now().toISO())):h.Z9.error("Error requesting the review, please try again. "+t.message),[2]}}))}))),[3,3]):[3,1];case 1:return[4,Kt.push("/marketing/reviews")];case 2:a.sent(),a.label=3;case 3:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),Ot=function(){var e=(0,i.Z)((function(){var e;return(0,d.__generator)(this,(function(t){switch(t.label){case 0:return ae(!0),[4,bt("/business/get-config").catch(console.log)];case 1:return(e=t.sent())&&!0===e.status&&e.content&&e.content.business&&(e.content.business.settings&&((0,h.Fs)("business.settings",e.content.business.settings),le(e.content.business.settings),(0,h.Fs)("business.config",e.content),lt(e.content)),e.content.business.marketing&&st(e.content.business.marketing)),ae(!1),[2]}}))}));return function(){return e.apply(this,arguments)}}(),Ut=function(){var e=(0,i.Z)((function(e){var t;return(0,d.__generator)(this,(function(n){switch(n.label){case 0:return ae(!0),[4,kt("/business/save-settings",{path:"customerColumns",value:e}).catch(console.log)];case 1:return(t=n.sent())&&!0===t.status&&t.content?((0,h.Fs)("business.settings",t.content),le(t.content)):h.Z9.error("Error saving the business settings, please try again. "+t.message),ae(!1),[2]}}))}));return function(t){return e.apply(this,arguments)}}(),zt=function(){var e=(0,i.Z)((function(){var e,t;return(0,d.__generator)(this,(function(n){switch(n.label){case 0:return(0,h.qE)(null===Ft||void 0===Ft||null===(e=Ft.user)||void 0===e?void 0:e.subscriptionStatus)?(ae(!0),[4,bt("/custom-field/get-by-category",{category:"customer"}).catch(console.log)]):[3,2];case 1:(t=n.sent())&&!0===t.status&&t.content&&((0,h.Fs)("customer.custom-fields",t.content),he(t.content)),ae(!1),n.label=2;case 2:return[2]}}))}));return function(){return e.apply(this,arguments)}}(),Xt=function(e){switch(e){case"number":return"HashtagIcon";case"money":return"CurrencyDollarIcon";case"date":return"CalendarIcon";case"checkbox":return"CheckCircleIcon";case"dropdown":return"ViewListIcon";case"rating":return"StarIcon";default:return"AnnotationIcon"}},Lt=function(){var e=(0,i.Z)((function(){var e,t;return(0,d.__generator)(this,(function(n){switch(n.label){case 0:return(0,h.qE)(null===Ft||void 0===Ft||null===(e=Ft.user)||void 0===e?void 0:e.subscriptionStatus)?(ae(!0),[4,bt("/customer/get-by-filter",{page:_e,perPage:10,query:ge,extended:je,sortBy:Ue,order:Le,type:Be}).catch(console.log)]):[3,2];case 1:return(t=n.sent())&&!0===t.status&&t.content&&((0,h.Fs)("customers",t.content),me(t.content),Gt(t.content.customers)),ae(!1),[3,3];case 2:me({total:0}),n.label=3;case 3:return[2]}}))}));return function(){return e.apply(this,arguments)}}(),Gt=function(){var e=(0,i.Z)((function(e){var t,n;return(0,d.__generator)(this,(function(s){switch(s.label){case 0:return(0,h.qE)(null===Ft||void 0===Ft||null===(t=Ft.user)||void 0===t?void 0:t.subscriptionStatus)?[4,bt("/nylas/count-unread-threads",{idsCustomer:e.map((function(e){return e._id}))},!1).catch(console.log)]:[3,2];case 1:(n=s.sent())&&!0===n.status&&n.content?at(n.content):at(null),s.label=2;case 2:return[2]}}))}));return function(t){return e.apply(this,arguments)}}(),Ht=function(){var e=(0,i.Z)((function(){var e;return(0,d.__generator)(this,(function(t){switch(t.label){case 0:return ae(!0),[4,kt(be._id?"/customer/edit":"/customer/create",be).catch(console.log)];case 1:return(e=t.sent())&&!0===e.status?(Lt(),Yt(),ke(null),Ae(!1),h.Z9.success("Contact saved!")):h.Z9.error("Error saving this contact, please try again. "+e.message),ae(!1),[2]}}))}));return function(){return e.apply(this,arguments)}}(),Bt=function(){var e=(0,i.Z)((function(e){return(0,d.__generator)(this,(function(t){return At("Delete contact?",(0,u.jsxs)(u.Fragment,{children:["Are you sure you want to delete the contact ",(0,u.jsxs)("span",{className:"font-medium",children:['"',e.firstName+" "+(e.lastName||""),'"']}),"?"]}),(0,i.Z)((function(){var t;return(0,d.__generator)(this,(function(n){switch(n.label){case 0:return ae(!0),[4,Ct("/customer/delete",{idCustomer:null===e||void 0===e?void 0:e._id}).catch(console.log)];case 1:return(t=n.sent())&&!0===t.status?(Lt(),Yt(),h.Z9.success("Contact deleted!")):h.Z9.error("Error deleting this contact, please try again. "+t.message),ae(!1),[2]}}))})),null),[2]}))}));return function(t){return e.apply(this,arguments)}}(),$t=function(e){var t=(0,h.p$)(Te);t=t.find((function(t){return t===e}))?t.filter((function(t){return t!==e})):(0,l.Z)(t).concat([e]),Me(t),Ut(t)},Vt=function(e,t){e!==Ue?(ze(e),Ge(1)):Ge(Le>0?-1:1),Ze(1),$e(t)},Yt=function(){var e=(0,i.Z)((function(){var e;return(0,d.__generator)(this,(function(t){switch(t.label){case 0:return[4,bt("/customer/count")];case 1:return(e=t.sent())&&!0===e.status&&e.content?ht(e.content||0):ht(0),[2]}}))}));return function(){return e.apply(this,arguments)}}();return(0,m.useEffect)((function(){return clearTimeout(s),s=setTimeout((function(){Lt()}),ge?400:10),function(){clearTimeout(s)}}),[Le,Ue,Be,_e,ge,je]),(0,m.useEffect)((function(){Ze(1),ze("createdAt"),Ge(-1),$e(null)}),[ge]),(0,m.useEffect)((function(){ge&&(ze("createdAt"),Ze(1))}),[je]),(0,m.useEffect)((function(){var e,t=(0,h.p$)(Te);null===oe||void 0===oe||null===(e=oe.customerColumns)||void 0===e||e.map((function(e){t.includes(e)||t.push(e)})),Me(t)}),[oe]),(0,m.useEffect)((function(){var e=(0,h.p$)(q);null===pe||void 0===pe||pe.map((function(t){e.find((function(e){return e._id===t._id}))||e.push(t)})),Pe(e)}),[pe]),(0,m.useEffect)((function(){Fe||(et(null),Qe(null))}),[Fe]),(0,m.useEffect)((function(){if(Dt){var e={};Pt&&(e={email:Pt}),qt&&(e=(0,a.Z)((0,r.Z)({},e),{firstName:qt})),Tt&&(e=(0,a.Z)((0,r.Z)({},e),{lastName:Tt})),ke(e),Ae(!0)}}),[Kt]),(0,m.useEffect)((function(){Ot(),zt(),Yt()}),[]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(D.Z,{context:"customers",open:gt,setOpen:vt}),(0,u.jsx)(D.Z,{context:"customers-import",open:jt,setOpen:wt}),!ue||ue.exists&&pt<0?(0,u.jsx)(p.Z,{variant:"table"}):"",ue&&!ue.exists&&(0,u.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,u.jsx)("div",{className:"max-w-xl mb-6",children:(0,u.jsx)("p",{className:"text-h3 lg:text-h1 font-extrabold text-gray-900",children:"Keep track of all your customers in one place"})}),(0,u.jsxs)("div",{className:"flex items-center flex-wrap gap-4 mb-10",children:[pt>=((null===Ft||void 0===Ft||null===(t=Ft.user)||void 0===t||null===(n=t.plan)||void 0===n||null===(f=n.limits)||void 0===f?void 0:f.customers)||Number.MAX_SAFE_INTEGER)?(0,u.jsx)("button",{className:"button primary",onClick:function(){return vt(!0)},children:"Add contact"}):(0,u.jsx)(F.Z,{className:"primary",onClick:function(){ke(P),Ae(!0)},loading:re,children:"Add contact"}),pt>=((null===Ft||void 0===Ft||null===(T=Ft.user)||void 0===T||null===(M=T.plan)||void 0===M||null===(O=M.limits)||void 0===O?void 0:O.customers)||Number.MAX_SAFE_INTEGER)||"free"===(null===Ft||void 0===Ft||null===(U=Ft.user)||void 0===U||null===(z=U.plan)||void 0===z?void 0:z.priceId)?(0,u.jsx)("button",{className:"button secondary",onClick:function(){return wt(!0)},children:"Import"}):(0,u.jsx)(g(),{href:"/crm/import",children:(0,u.jsx)("a",{className:"button secondary",children:"Import"})}),(0,u.jsx)(g(),{href:"https://help.durable.co/en-US/articles/crm-55542",children:(0,u.jsxs)("a",{className:"link flex items-center gap-2",target:"_blank",children:[(0,u.jsx)("span",{className:"text-sm",children:"Learn more"}),(0,u.jsx)(x.Z,{icon:"ExternalLinkIcon",className:"w-4 h-4"})]})})]}),(0,u.jsx)("div",{className:"flex items-center justify-center w-full h-[215px] sm:h-[380px] md:h-[420px] lg:h-[480px] rounded-lg shadow-lg bg-black overflow-hidden",children:(0,u.jsx)("iframe",{src:"https://www.loom.com/embed/49e111ced82e4875b369b2e234d23ca6",width:"100%",height:"100%",frameBorder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0})})]}),ue&&ue.exists&&pt>=0&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"relative flex items-center justify-between gap-3 mb-4 lg:mb-6",children:[(0,u.jsx)("div",{className:(0,h.AK)("flex-col md:flex-row gap-3 w-full md:w-auto justify-center md:justify-start",ut?"flex":"hidden md:flex"),children:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"flex items-center gap-3",children:[(0,u.jsxs)("div",{className:"flex-1 relative",children:[(0,u.jsx)("span",{className:"absolute top-1/2 z-10 pl-2.5 -translate-y-1/2",children:(0,u.jsx)(x.Z,{icon:"SearchIcon",className:"w-5 h-5"})}),(0,u.jsx)(v.Z,{className:"flex-1 w-full md:w-auto",inputClassName:"!pl-9",value:ge,onChange:function(e){return ve(e)},placeholder:"Search"})]}),(0,u.jsx)("div",{className:"flex-shrink-0 md:hidden",children:(0,u.jsx)("button",{className:"round secondary",onClick:function(){return mt(!1)},children:(0,u.jsx)(x.Z,{icon:"XIcon",className:"w-4 h-4 text-gray-700"})})})]}),(0,u.jsx)("div",{className:(0,h.AK)("items-center justify-between md:justify-start gap-3",ge?"block md:flex":"hidden"),children:(0,u.jsxs)("label",{className:(0,h.AK)("flex items-center relative group"),title:"",children:[(0,u.jsx)("div",{className:"block absolute z-50 p-4 bg-white shadow-lg rounded-lg w-56 top-full transition-opacity pointer-events-none group-hover:opacity-100 opacity-0 border border-gray-100",children:"In addition to search for name, email and phone, search as well for address, notes, etc."}),(0,u.jsx)(k.Z,{enabled:je,onChange:function(e){return we(e)},className:"mr-2"})," Extended search ",(0,u.jsx)(x.Z,{icon:"QuestionMarkCircleIcon",className:"w-4 h-4 ml-2 text-indigo-400 hover:text-indigo-600"})]})})]})}),(0,u.jsx)("div",{className:(0,h.AK)(ut?"hidden":"md:hidden"),children:(0,u.jsx)("button",{className:"round light",onClick:function(){return mt(!0)},children:(0,u.jsx)(x.Z,{icon:"SearchIcon",className:"w-4 h-4"})})}),(0,u.jsxs)("div",{className:(0,h.AK)("items-center gap-3",ut?"hidden md:flex":"flex"),children:[pt>=((null===Ft||void 0===Ft||null===(X=Ft.user)||void 0===X||null===(L=X.plan)||void 0===L||null===(G=L.limits)||void 0===G?void 0:G.customers)||Number.MAX_SAFE_INTEGER)||"free"===(null===Ft||void 0===Ft||null===(H=Ft.user)||void 0===H||null===(B=H.plan)||void 0===B?void 0:B.priceId)?(0,u.jsx)("button",{className:"button secondary",onClick:function(){return wt(!0)},children:"Import"}):(0,u.jsx)(g(),{href:"/crm/import",children:(0,u.jsx)("a",{className:"button secondary",children:"Import"})}),pt>=((null===Ft||void 0===Ft||null===($=Ft.user)||void 0===$||null===(V=$.plan)||void 0===V||null===(Y=V.limits)||void 0===Y?void 0:Y.customers)||Number.MAX_SAFE_INTEGER)?(0,u.jsx)("button",{className:"button primary",onClick:function(){return vt(!0)},children:"Create contact"}):(0,u.jsx)(F.Z,{className:"primary",onClick:function(){ke(P),Ae(!0)},loading:re,children:"Create contact"})]})]}),(null===ot||void 0===ot||null===(Q=ot.business)||void 0===Q||null===(J=Q.nylas)||void 0===J?void 0:J.invalid)&&(null===ot||void 0===ot||null===(W=ot.business)||void 0===W||null===(ee=W.nylas)||void 0===ee?void 0:ee.token)&&(0,u.jsx)("div",{className:"sticky top-24 mt-1 z-50 mb-6",children:(0,u.jsx)("div",{className:"rounded-md bg-yellow-50 py-3 px-4 shadow",children:(0,u.jsxs)("div",{className:"flex md:items-center",children:[(0,u.jsx)("div",{className:"flex-shrink-0",children:(0,u.jsx)(x.Z,{icon:"ExclamationIcon",className:"h-5 w-5 text-yellow-400","aria-hidden":"true"})}),(0,u.jsxs)("div",{className:"ml-3 flex-1 md:flex md:justify-between md:items-center",children:[(0,u.jsxs)("p",{className:"text-sm text-yellow-700",children:[(0,u.jsx)("span",{className:"font-medium mr-2",children:"Email sync stopped!"})," You need to reconnect your email."]}),(0,u.jsx)(g(),{href:"/crm/settings",children:(0,u.jsx)("a",{className:"link sm",children:"Reconnect email"})})]})]})})}),(0,u.jsxs)("div",{className:"shadow rounded-lg bg-white overflow-hidden",children:[(0,u.jsx)("div",{className:"overflow-x-auto bg-white",children:(0,u.jsxs)("table",{className:"divide-y divide-gray-200 w-full",children:[(0,u.jsx)("thead",{className:"bg-white divide-y divide-gray-200 ",children:(0,u.jsxs)("tr",{className:"bg-gray-50 w-full",children:[(0,u.jsx)("th",{scope:"col",className:"rounded-tl-lg px-2 md:px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider sticky left-0 bg-gray-50",onClick:function(){return Vt("firstName")},children:(0,u.jsxs)("div",{className:"group flex items-center gap-2 cursor-pointer",children:[(0,u.jsx)("span",{className:"hidden md:block",children:"Name"}),(0,u.jsx)("span",{className:"md:hidden",children:"Name / Company"}),"firstName"===Ue?(0,u.jsx)(x.Z,{icon:Le>0?"ChevronUpIcon":"ChevronDownIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0"}):(0,u.jsx)(x.Z,{icon:"SelectorIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"})]})}),(0,u.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider",onClick:function(){return Vt("email")},children:(0,u.jsxs)("div",{className:"group flex items-center gap-2 cursor-pointer min-w-[65px]",children:[(0,u.jsx)("span",{children:"E-mail"}),"email"===Ue?(0,u.jsx)(x.Z,{icon:Le>0?"ChevronUpIcon":"ChevronDownIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0"}):(0,u.jsx)(x.Z,{icon:"SelectorIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"})]})}),(0,u.jsx)("th",{scope:"col",className:(0,h.AK)(!Te.includes("feedback")&&"!hidden","lg:hidden px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"),onClick:function(){return Vt("feedback")},children:(0,u.jsxs)("div",{className:"group flex items-center gap-2 cursor-pointer",children:[(0,u.jsx)("span",{children:"Feedback"}),"feedback"===Ue?(0,u.jsx)(x.Z,{icon:Le>0?"ChevronUpIcon":"ChevronDownIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0"}):(0,u.jsx)(x.Z,{icon:"SelectorIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"})]})}),(0,u.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider",onClick:function(){return Vt("createdAt")},children:(0,u.jsxs)("div",{className:"group flex items-center gap-2 cursor-pointer",children:[(0,u.jsx)("span",{children:"Created"}),"createdAt"===Ue?(0,u.jsx)(x.Z,{icon:Le>0?"ChevronUpIcon":"ChevronDownIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0"}):(0,u.jsx)(x.Z,{icon:"SelectorIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"})]})}),(0,u.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider",onClick:function(){return Vt("totalUnreadMessages")},children:(0,u.jsxs)("div",{className:"group flex items-center gap-2 cursor-pointer",children:[(0,u.jsx)("span",{children:"Unread messages"}),"totalUnreadMessages"===Ue?(0,u.jsx)(x.Z,{icon:Le>0?"ChevronUpIcon":"ChevronDownIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0"}):(0,u.jsx)(x.Z,{icon:"SelectorIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"})]})}),De.map((function(e){return"checkbox"!==e.type?(0,u.jsx)("th",{scope:"col",className:(0,h.AK)(!Te.includes(e._id)&&"!hidden","hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 capitalize tracking-wider"),onClick:function(){return Vt(e._id,e.type)},children:(0,u.jsxs)("div",{className:"group flex items-center gap-2 cursor-pointer",children:[(0,u.jsx)("span",{children:e.name}),Ue===e._id?(0,u.jsx)(x.Z,{icon:Le>0?"ChevronUpIcon":"ChevronDownIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0"}):(0,u.jsx)(x.Z,{icon:"SelectorIcon",className:"w-4 h-4 text-gray-500 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"})]})},e._id):(0,u.jsx)("th",{scope:"col",className:(0,h.AK)(!Te.includes(e._id)&&"!hidden","hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 capitalize tracking-wider"),children:(0,u.jsx)("span",{children:e.name})},e._id)})),(0,u.jsx)("th",{scope:"col",className:(0,h.AK)("px-6 py-3 text-left text-xs font-medium text-gray-500 tracking-wider"),children:(0,u.jsx)("div",{className:"flex items-center gap-2",children:(0,u.jsx)("span",{children:"Unread email"})})}),(0,u.jsx)("th",{scope:"col",className:"hidden md:table-cell md:px-6 py-3 text-right sticky right-0 bg-gradient-to-l from-gray-50 bg-gray-50 bg-opacity-70 rounded-br-lg",children:(0,u.jsxs)(Z.Z,{className:"inline-block z-10",icon:"CogIcon",buttonClassName:"button round hover:bg-indigo-50",openClassName:"bg-indigo-50",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"px-3 pt-4 pb-2 text-xs font-medium text-gray-500",children:"Visible columns"}),De.filter((function(e){return Te.includes(e._id)})).map((function(e){return(0,u.jsxs)("div",{className:"group flex items-center justify-between gap-4 py-2 px-3 hover:bg-gray-50 transition-all cursor-pointer",onClick:function(){return $t(e._id)},children:[(0,u.jsxs)("p",{className:"inline-flex items-center gap-2 text-sm leading-5 font-medium text-gray-800 capitalize",children:[e.type&&(0,u.jsx)(x.Z,{icon:Xt(e.type),className:"flex-none w-4 h-4 text-gray-500"}),e.name]}),(0,u.jsxs)("div",{className:"flex gap-2",children:[e.type&&(0,u.jsx)("p",{className:"opacity-0 group-hover:opacity-100 transition-all",children:(0,u.jsx)("button",{onClick:function(t){t.stopPropagation(),et(e),Qe("edit"),Ke(!0)},disabled:re,children:(0,u.jsx)(x.Z,{icon:"PencilIcon",className:"h-4 w-4 text-gray-500"})})}),(0,u.jsx)(x.Z,{icon:"CheckIcon",className:"h-4 w-4 text-indigo-600"})]})]},e._id)}))]}),(0,u.jsx)("hr",{className:"my-4"}),(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"px-3 pb-2 text-xs font-medium text-gray-500",children:"Available columns"}),De.filter((function(e){return!Te.includes(e._id)})).map((function(e){return(0,u.jsxs)("div",{className:"group flex items-center justify-between gap-2 py-2 px-3 hover:bg-gray-50 transition-all cursor-pointer",onClick:function(){return $t(e._id)},children:[(0,u.jsxs)("p",{className:"inline-flex items-center gap-2 text-sm leading-5 font-medium text-gray-800 capitalize",children:[e.type&&(0,u.jsx)(x.Z,{icon:Xt(e.type),className:"flex-none w-4 h-4 text-gray-500"}),e.name]}),(0,u.jsx)("div",{className:"flex gap-2 opacity-0 group-hover:opacity-100 transition-all",children:e.type&&(0,u.jsx)("button",{onClick:function(t){t.stopPropagation(),et(e),Qe("edit"),Ke(!0)},disabled:re,children:(0,u.jsx)(x.Z,{icon:"PencilIcon",className:"h-4 w-4 text-gray-500"})})})]},e._id)}))]}),(0,u.jsx)("div",{className:"px-3 py-2.5",children:(0,u.jsx)("button",{onClick:function(){Qe("new"),Ke(!0)},className:"secondary sm w-full",children:"+ Add new field"})})]})})]})}),(0,u.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200 ",children:[(!ue||!ue.customers||0===ue.customers.length)&&(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"100%",className:"px-6 py-3 whitespace-nowrap text-sm text-gray-500",children:"No contact found"})}),null===ue||void 0===ue||null===(te=ue.customers)||void 0===te?void 0:te.map((function(e){var t,n,s,i,r,a;return(0,u.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer group w-full",onClick:function(){return Kt.push("/crm/".concat(e._id))},children:[(0,u.jsxs)("td",{className:"px-2 md:px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900 sticky left-0 z-10 bg-white group-hover:bg-gray-50",children:[e.firstName+" "+(e.lastName||""),(0,u.jsx)("p",{className:"md:hidden text-gray-500 text-body-sm",children:e.company||""})]}),(0,u.jsx)("td",{className:" px-2 md:px-6 py-3 whitespace-nowrap text-xs",children:(0,u.jsx)(K.Z,{text:e.email,children:e.email})}),(0,u.jsx)("td",{className:"px-2 md:px-6 py-3 whitespace-nowrap text-xs",children:_.ou.fromISO(e.createdAt).toFormat("DD @ HH:mm")}),(0,u.jsx)("td",{className:"px-2 md:px-6 py-3 whitespace-nowrap text-xs",children:(null===(n=null===(t=e.messages)||void 0===t?void 0:t.filter((function(e){return e.unread})))||void 0===n?void 0:n.length)>0?(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)("span",{className:"flex text-indigo-600 items-center font-medium",children:[(0,u.jsx)(x.Z,{icon:"ChatBubbleBottomCenterTextIcon",variant:"outline",className:"w-5 h-5 mr-2"}),null===(i=null===(s=e.messages)||void 0===s?void 0:s.filter((function(e){return e.unread})))||void 0===i?void 0:i.length]})}):""}),(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes("company")&&"!hidden","hidden lg:table-cell px-6 py-3 whitespace-nowrap text-xs text-gray-500"),children:e.company||""}),(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes("lastMessage.createdAt")&&"!hidden","px-2 md:px-6 py-3 whitespace-nowrap text-xs"),children:ne(e)}),(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes("feedback")&&"!hidden","px-2 md:px-6 py-3 whitespace-nowrap text-xs"),children:(0,u.jsx)(C.Z,{rating:e.rating,readOnly:!0})}),(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes("phone")&&"!hidden","hidden lg:table-cell px-6 py-3 whitespace-nowrap text-xs text-indigo-600"),children:(0,u.jsx)(g(),{href:"tel:"+e.phone,children:(0,u.jsxs)("a",{className:"link w-auto",onClick:function(e){return e.stopPropagation()},children:[e.phone," "]})})}),(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes("address")&&"!hidden","hidden lg:table-cell px-6 py-3 whitespace-nowrap"),children:e.address&&(0,u.jsxs)("p",{className:"flex gap-1 flex-wrap text-xs text-gray-500",children:[(0,u.jsx)("span",{children:e.address.line1?e.address.line1:""}),(0,u.jsx)("span",{children:e.address.line2?e.address.line2:""}),(0,u.jsx)("span",{children:e.address.city||e.address.state||e.address.country?(e.address.city?e.address.city:"")+(e.address.state?(e.address.city?" - ":"")+e.address.state:"")+(e.address.country?(e.address.state||e.address.city?" - ":"")+e.address.country:""):""}),(0,u.jsx)("span",{children:e.address.postalCode&&e.address.postalCode})]})}),null===pe||void 0===pe?void 0:pe.map((function(t){var n,s,i=null===(s=null===e||void 0===e||null===(n=e.customFields)||void 0===n?void 0:n.find((function(e){return e.Field===t._id})))||void 0===s?void 0:s.value;switch(t.type){case"money":return(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes(t._id)&&"!hidden","hidden lg:table-cell px-6 py-3 whitespace-nowrap text-xs text-gray-500"),children:null!==i&&void 0!==i&&(0,u.jsxs)(u.Fragment,{children:["$",Number(i).toFixed(2)]})},t._id);case"rating":return(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes(t._id)&&"!hidden","hidden lg:table-cell px-6 py-3 whitespace-nowrap text-xs text-gray-500"),children:(0,u.jsx)(C.Z,{rating:i,readOnly:!0})},t._id);case"date":return(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes(t._id)&&"!hidden","hidden lg:table-cell px-6 py-3 whitespace-nowrap text-xs text-gray-500"),children:i&&_.ou.fromISO(i).toFormat("DD")},t._id);case"dropdown":var r;return(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes(t._id)&&"!hidden","hidden lg:table-cell px-6 py-3 whitespace-nowrap text-xs text-gray-500"),children:null!==i&&void 0!==i&&(null===(r=t.options.find((function(e){return e.id===i})))||void 0===r?void 0:r.name)},t._id);case"checkbox":return(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes(t._id)&&"!hidden","hidden lg:table-cell px-6 py-3 whitespace-nowrap text-xs text-gray-500"),children:null===i||void 0===i?void 0:i.map((function(e){var n;return null===(n=t.options.find((function(t){return t.id===e})))||void 0===n?void 0:n.name})).join(", ")},t._id);default:return(0,u.jsx)("td",{className:(0,h.AK)(!Te.includes(t._id)&&"!hidden","hidden lg:table-cell px-6 py-3 whitespace-nowrap text-xs text-gray-500"),children:i},t._id)}})),(0,u.jsx)("td",{className:(0,h.AK)("px-2 md:px-6 py-3 whitespace-nowrap text-xs text-center"),children:rt&&(null===(r=rt.find((function(t){return t.email===e.email})))||void 0===r?void 0:r.count)>0?(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)("span",{className:"flex text-indigo-600 items-center font-medium",children:[(0,u.jsx)(x.Z,{icon:"MailIcon",className:"w-5 h-5 mr-2"})," ",null===(a=rt.find((function(t){return t.email===e.email})))||void 0===a?void 0:a.count]})}):""}),(0,u.jsx)("td",{className:"z-10 md:px-6 py-3 text-right sticky right-0 bg-gradient-to-l from-white bg-white bg-opacity-70 text-sm font-medium space-x-3 items-center align-middle group-hover:bg-gray-50 group-hover:bg-opacity-80",children:(0,u.jsxs)(N.Z,{inline:!0,buttonClassName:"button round hover:bg-indigo-50",openClassName:"bg-indigo-50",children:[(0,u.jsx)(A.v.Item,{as:"div",children:(0,u.jsx)(g(),{href:"/invoices/create?contact="+e._id,children:(0,u.jsx)("a",{className:"block px-4 py-2.5 hover:bg-gray-100 text-gray-700",onClick:function(e){return e.stopPropagation()},children:"Invoice"})})}),(0,u.jsx)(A.v.Item,{as:"div",children:(0,u.jsx)(g(),{href:"/crm/".concat(e._id,"?open=compose"),children:(0,u.jsx)("a",{className:"block px-4 py-2.5 hover:bg-gray-100 text-gray-700",onClick:function(e){return e.stopPropagation()},children:"Email"})})}),(0,u.jsx)(A.v.Item,{as:"div",children:(0,u.jsx)("div",{onClick:function(t){t.stopPropagation(),Mt(e)},className:"block px-4 py-2.5 hover:bg-gray-100 text-gray-700 cursor-pointer",children:"Request review"})}),(0,u.jsx)(A.v.Item,{as:"div",children:(0,u.jsx)(g(),{href:"/crm/".concat(e._id),children:(0,u.jsx)("a",{className:"block px-4 py-2.5 hover:bg-gray-100 text-gray-700",onClick:function(e){return e.stopPropagation()},children:"Manage"})})}),(0,u.jsx)(A.v.Item,{as:"div",children:(0,u.jsx)("div",{className:"block px-4 py-2.5 hover:bg-red-100 text-red-700 cursor-pointer",onClick:function(t){t.stopPropagation(),Bt(e)},children:"Delete"})})]})})]},e._id)}))]})]})}),(null===ue||void 0===ue?void 0:ue.total)>0&&(0,u.jsx)(S.Z,{className:"sticky bottom-0",page:_e,results:ue,loading:re,setPage:Ze})]})]}),(0,u.jsx)(It,{confirmText:"Request review"}),(0,u.jsx)(Et,{attention:!0}),(0,u.jsx)(y.M,{customer:be,setCustomer:ke,open:Se,setOpen:Ae,loading:re,save:Ht},"manage-fields-".concat(null===pe||void 0===pe?void 0:pe.length)),(0,u.jsx)(j.M,{field:We,action:Ye,open:Fe,setOpen:Ke,onUpdate:zt,category:"customer"})]})}T.auth=!0}},function(e){e.O(0,[6440,7333,696,9198,7554,7204,1954,9774,2888,179],(function(){return t=47489,e(e.s=t);var t}));var t=e.O();_N_E=t}]);