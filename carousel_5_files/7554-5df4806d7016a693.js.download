"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7554],{57554:function(e,n,t){t.d(n,{M:function(){return j}});var i=t(47568),o=t(26042),s=t(69396),r=t(29815),a=t(70655),l=t(85893),c=t(11355),d=t(69737),u=t(67294),m=t(65082),p=t(60728),f=t(33303),x=t(30112),h=t(51121),g=t(16494),v=t(52077),y=t(73935);function j(e){var n,t=e.open,j=e.setOpen,b=e.category,N=e.field,w=e.action,Z=e.canSelect,k=e.onUpdate,C=e.info,F=(0,m.Z)(),I=F.get,_=F.post,A=(0,u.useState)(!1),E=A[0],T=A[1],D=(0,u.useState)((0,f.tl)(b+".custom-fields")),S=D[0],O=D[1],P=(0,u.useState)(null),R=P[0],z=P[1],V=(0,u.useState)(null),U=V[0],K=V[1],M=(0,p.Z)(),Y=M.confirm,q=M.ConfirmDialog,H=(0,u.useRef)(null),L=(0,u.useRef)(null),X=function(){K(null),z(null)},B=function(e){switch(e){case"number":return"HashtagIcon";case"money":return"CurrencyDollarIcon";case"date":return"CalendarIcon";case"checkbox":return"CheckCircleIcon";case"dropdown":return"ViewListIcon";case"rating":return"StarIcon";default:return"AnnotationIcon"}},G=function(){var e,n;(0,y.flushSync)((function(){var e;K((0,s.Z)((0,o.Z)({},U),{options:(0,r.Z)(U.options).concat([{id:null===U||void 0===U||null===(e=U.options)||void 0===e?void 0:e.length,name:""}])}))})),null===(e=L.current)||void 0===e||null===(n=e.lastElementChild)||void 0===n||n.scrollIntoView()},J=function(e,n){for(var t=[],i=0;i<U.options.length;i++){var r=U.options[i];i===e&&(r=n),t.push(r)}K((0,s.Z)((0,o.Z)({},U),{options:t}))},Q=function(e){var n=U.options;n.splice(e,1),K((0,s.Z)((0,o.Z)({},U),{options:n}))},W=function(){var e=(0,i.Z)((function(){var e;return(0,a.__generator)(this,(function(n){switch(n.label){case 0:return[4,I("/custom-field/get-by-category",{category:b}).catch(console.log)];case 1:return(e=n.sent())&&!0===e.status&&e.content&&((0,f.Fs)(b+".custom-fields",e.content),O(e.content)),[2]}}))}));return function(){return e.apply(this,arguments)}}(),$=function(){var e=(0,i.Z)((function(){var e,n;return(0,a.__generator)(this,(function(t){switch(t.label){case 0:if(e=!0,U._id&&(e=!1),["checkbox","dropdown"].includes(U.type)){if(0===U.options.length||"dropdown"===U.type&&U.options.length<2)return f.Z9.error("You must inform at least 1 option for this field."),[2];if(U.options.some((function(e){return""===e.name})))return f.Z9.error("You can't add an option without name."),[2]}return T(!0),U.idCustomField=U._id,U.category=b,[4,_(e?"/custom-field/create":"/custom-field/edit",U).catch(console.log)];case 1:return(n=t.sent())&&!0===n.status?(e?j(!1):W(),X(),f.Z9.success("Field saved!"),"function"===typeof k&&k({action:e?"create":"update",field:n.content})):f.Z9.error("Error saving this field, please try again. "+n.message),T(!1),[2]}}))}));return function(){return e.apply(this,arguments)}}(),ee=function(){var e=(0,i.Z)((function(e){var n;return(0,a.__generator)(this,(function(t){switch(t.label){case 0:return T(!0),[4,_("/custom-field/delete",{idCustomField:e}).catch(console.log)];case 1:return(n=t.sent())&&!0===n.status?(W(),X(),f.Z9.success("Field deleted!"),"function"===typeof k&&k({action:"delete",field:n.content})):f.Z9.error("Error removing this field, please try again. "+n.message),T(!1),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),ne=function(e){Z&&"function"===typeof k&&k({action:"select",field:e})};return(0,u.useEffect)((function(){S&&0!==S.length||z("new")}),[S]),(0,u.useEffect)((function(){"new"===R&&(0!==(null===U||void 0===U?void 0:U.options.length)||"checkbox"!==U.type&&"dropdown"!==U.type||("dropdown"===U.type?K((0,s.Z)((0,o.Z)({},U),{options:(0,r.Z)(U.options).concat([{id:0,name:"-",default:!0}])})):G()))}),[U]),(0,u.useEffect)((function(){t&&W(),t&&(N||w)?(z(w),K(N)):X()}),[t]),(0,l.jsx)(c.u.Root,{show:t,as:u.Fragment,children:(0,l.jsx)(d.V,{as:"div",className:"fixed z-100 inset-0 overflow-y-auto",initialFocus:H,onClose:function(){return j(!1)},children:(0,l.jsxs)("div",{className:"flex items-end justify-center min-h-screen text-center md:block",children:[(0,l.jsx)(c.u.Child,{as:u.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,l.jsx)(d.V.Overlay,{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-2xs transition-opacity"})}),(0,l.jsx)("span",{className:"hidden md:inline-block md:align-middle md:h-screen","aria-hidden":"true",children:"\u200b"}),(0,l.jsx)(c.u.Child,{as:u.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 md:translate-y-0 md:scale-95",enterTo:"opacity-100 translate-y-0 md:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 md:scale-100",leaveTo:"opacity-0 translate-y-4 md:translate-y-0 md:scale-95",children:(0,l.jsxs)("div",{className:"inline-block align-middle bg-white rounded-lg my-8 max-w-xl w-full text-left overflow-visible shadow-xl transform transition-all",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between border-b p-4 lg:p-6",children:[(0,l.jsx)(d.V.Title,{className:"text-center leading-6 font-bold text-gray-900",children:"new"===R?"Add a custom field":"edit"===R?"Edit the custom field":(0,l.jsx)(l.Fragment,{children:"Custom fields"})}),(0,l.jsx)("button",{type:"button",className:"flex-shrink-0 text-gray-600 hover:text-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ml-auto",onClick:function(){return j(!1)},children:(0,l.jsx)(x.Z,{icon:"XIcon",className:"h-6 w-6","aria-hidden":"true"})})]}),C&&(0,l.jsx)("div",{className:"p-4 lg:p-6 mb-6 border-b border-t border-gray-200",children:C}),"new"===R&&!U&&(0,l.jsxs)("div",{className:"p-4 lg:p-6",children:[(0,l.jsx)("label",{className:"font-medium mb-4",children:"Choose the type"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[{id:1,value:"text",name:"Text",description:"Add a single line of text for anything you want to keep track of."},{id:2,value:"number",name:"Number",description:"Add a number field to keep count of anything."},{id:3,value:"money",name:"Money",description:"Add a currency field to record a monetary value."},{id:4,value:"date",name:"Date",description:"Add a date field to keep track of birthdays, appointments, or anything else."},{id:5,value:"checkbox",name:"Checkbox",description:"A simple yes or no checkbox to quickly visualize something."},{id:6,value:"dropdown",name:"Dropdown",description:"Use a dropdown to select from a list of options you define."},{id:7,value:"rating",name:"Rating",description:"Use a rating field to rank your leads or describe how great something is."}].map((function(e){return(0,l.jsxs)("div",{className:"group flex items-center gap-4 border border-gray-300 p-4 rounded-md hover:bg-indigo-50 hover:border-indigo-600 cursor-pointer",onClick:function(){return K({type:e.value,options:[]})},children:[(0,l.jsx)(x.Z,{icon:B(e.value),className:"flex-none w-6 h-6 text-gray-500 group-hover:text-indigo-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium group-hover:text-indigo-600",children:e.name}),(0,l.jsx)("p",{className:"text-xs text-gray-500",children:e.description})]})]},e.id)}))})]}),R&&U&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"p-4 lg:p-6 flex flex-col md:flex-row gap-4",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)(h.Z,{label:"Field label",value:U.name,onChange:function(e){return K((0,s.Z)((0,o.Z)({},U),{name:e}))}})}),(0,l.jsx)("div",{className:"flex-none",children:(0,l.jsx)(h.Z,{inputClassName:"capitalize",label:"Type",value:U.type,readOnly:!0,prefix:(0,l.jsx)(x.Z,{icon:B(U.type),className:"flex-none w-5 h-5 text-gray-500 group-hover:text-indigo-600"})})})]}),("checkbox"===U.type||"dropdown"===U.type)&&(0,l.jsxs)("div",{children:[(null===(n=U.options)||void 0===n?void 0:n.length)>0&&(0,l.jsx)("div",{className:"px-4 lg:px-6 max-h-96 overflow-y-auto scrollbar-transparent",children:(0,l.jsx)("ul",{className:"space-y-4 mb-2",ref:L,children:U.options.map((function(e,n){return"dropdown"!==U.type||0===n||e.default?"checkbox"===U.type?(0,l.jsxs)("li",{className:"flex items-center gap-4",children:[(0,l.jsx)(h.Z,{readOnly:e.default,label:"Option ".concat(n+1),value:e.name,onChange:function(e){return J(n,(0,s.Z)((0,o.Z)({},U.options[n]),{name:e}))},className:"flex-1"}),!e.default&&(0,l.jsx)("button",{className:"mt-4",onClick:function(){return Q(n)},children:(0,l.jsx)(x.Z,{icon:"TrashIcon",from:"heroicons",className:"h-5 w-5 text-red-500"})})]},n):void 0:(0,l.jsxs)("li",{className:"flex items-center gap-4",children:[(0,l.jsx)(h.Z,{readOnly:e.default,label:"Option ".concat(n),value:e.name,onChange:function(e){return J(n,(0,s.Z)((0,o.Z)({},U.options[n]),{name:e}))},className:"flex-1"}),!e.default&&(0,l.jsx)("button",{className:"mt-4",onClick:function(){return Q(n)},children:(0,l.jsx)(x.Z,{icon:"TrashIcon",from:"heroicons",className:"h-5 w-5 text-red-500"})})]},n)}))})}),(0,l.jsx)("div",{className:"px-4 lg:px-6",children:(0,l.jsxs)("button",{className:"link sm inline-flex items-center gap-1",onClick:function(){return G()},children:[(0,l.jsx)("span",{children:"Add option"}),(0,l.jsx)(x.Z,{icon:"PlusIcon",className:"h-4 w-4"})]})})]})]}),!R&&(0,l.jsxs)(l.Fragment,{children:[(null===S||void 0===S?void 0:S.filter((function(e){return e.default})).length)>0&&(0,l.jsxs)("div",{className:"p-4 lg:p-6",children:[(0,l.jsx)("label",{className:"mb-2 text-label-xs",children:"Default fields"}),(0,l.jsx)("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mb-8",children:S.filter((function(e){return e.default})).map((function(e){return(0,l.jsxs)("li",{className:(0,f.AK)("group flex justify-between items-center gap-4 py-4 pl-4 pr-2 border border-gray-200 rounded-md hover:border-indigo-600",Z&&"cursor-pointer"),onClick:function(){return ne(e)},children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)(x.Z,{icon:B(e.type),className:"flex-none w-6 h-6 text-gray-500 group-hover:text-indigo-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-label-xs capitalize text-gray-500",children:e.type}),(0,l.jsx)("p",{className:"group-hover:text-indigo-600",children:e.name})]})]}),(0,l.jsx)("div",{children:(0,l.jsx)("button",{className:"p-2 text-gray-500 hover:text-indigo-600",disabled:E,onClick:function(n){n.stopPropagation(),K(e),z("edit")},children:(0,l.jsx)(x.Z,{icon:"PencilIcon",from:"heroicons",className:"h-4 w-4"})})})]},e._id)}))})]}),(0,l.jsxs)("div",{className:"p-4 lg:p-6",children:[(0,l.jsx)("label",{className:"mb-2 text-label-xs",children:"Existing fields"}),(0,l.jsxs)("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 mb-8",children:[null===S||void 0===S?void 0:S.filter((function(e){return!e.default})).map((function(e){return(0,l.jsxs)("li",{className:(0,f.AK)("group flex justify-between items-center gap-4 py-4 pl-4 pr-2 border border-gray-200 rounded-md hover:border-indigo-600",Z&&"cursor-pointer"),onClick:function(){return ne(e)},children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)(x.Z,{icon:B(e.type),className:"flex-none w-6 h-6 text-gray-500 group-hover:text-indigo-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-label-xs capitalize text-gray-500",children:e.type}),(0,l.jsx)("p",{className:"group-hover:text-indigo-600",children:e.name})]})]}),(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("button",{className:"p-2 text-gray-500 hover:text-indigo-600",disabled:E,onClick:function(n){n.stopPropagation(),K(e),z("edit")},children:(0,l.jsx)(x.Z,{icon:"PencilIcon",from:"heroicons",className:"h-4 w-4"})}),(0,l.jsx)("button",{className:"p-2 text-red-500 hover:text-red-700",disabled:E,onClick:function(n){n.stopPropagation(),Y("Delete custom field",(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{children:"Are you sure you want to delete this custom field?"}),(0,l.jsxs)("div",{className:"alert danger mt-4",children:[(0,l.jsx)(x.Z,{icon:"ExclamationIcon"}),(0,l.jsx)("p",{children:"Removing this field, will remove it from every contact, not only this one."})]})]}),(function(){return ee(e._id)}),null)},children:E?(0,l.jsx)(g.Z,{text:""}):(0,l.jsx)(x.Z,{icon:"TrashIcon",from:"heroicons",className:"h-4 w-4"})})]})]},e._id)})),(0,l.jsx)("li",{className:"group flex justify-between items-center gap-4 p-5 border border-dashed border-gray-200 rounded-md hover:border-indigo-600 cursor-pointer",onClick:function(){return z("new")},children:(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)(x.Z,{icon:"PlusIcon",className:"flex-none w-6 h-6 text-gray-500 group-hover:text-indigo-600"}),(0,l.jsx)("p",{className:"text-gray-500",children:"New custom field"})]})})]})]})]}),R&&(0,l.jsxs)("div",{className:"flex justify-between gap-4 p-4 lg:px-6 mt-6 border-t",children:[(0,l.jsx)("div",{className:"flex-1",children:(null===U||void 0===U?void 0:U._id)&&"edit"===R&&!U.default&&(0,l.jsx)("button",{className:"attention",onClick:function(){return Y("Delete custom field",(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{children:"Are you sure you want to delete this custom field?"}),(0,l.jsxs)("div",{className:"alert danger mt-4",children:[(0,l.jsx)(x.Z,{icon:"ExclamantionIcon"}),(0,l.jsx)("p",{children:"Removing this field, will remove it from every contact, not only this one."})]})]}),(function(){return ee(U._id)}),null)},disabled:E,children:"Delete"})}),(0,l.jsxs)("div",{className:"flex items-end gap-4",children:[(0,l.jsx)("button",{type:"button",className:"light",onClick:function(){return"new"===R&&U?K(null):X()},children:"Cancel"}),("new"===R&&U&&U.type||"edit"===R)&&(0,l.jsx)(v.Z,{type:"button",className:"primary",onClick:function(){return $()},loading:E,children:"Save"})]})]})]})}),(0,l.jsx)(q,{attention:!0})]})})})}}}]);